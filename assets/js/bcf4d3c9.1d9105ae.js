"use strict";(self.webpackChunkpioneer_docs=self.webpackChunkpioneer_docs||[]).push([[125],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return g}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),u=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),g=a,h=p["".concat(s,".").concat(g)]||p[g]||d[g]||o;return n?i.createElement(h,r(r({ref:t},c),{},{components:n})):i.createElement(h,r({ref:t},c))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var u=2;u<o;u++)r[u]=n[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5149:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return u},toc:function(){return c},default:function(){return p}});var i=n(7462),a=n(3366),o=(n(7294),n(3905)),r=["components"],l={id:"ruby-sdk-doc",title:"Ruby SDK"},s="Ruby SDK",u={unversionedId:"ruby-sdk-doc",id:"ruby-sdk-doc",isDocsHomePage:!1,title:"Ruby SDK",description:"Test",source:"@site/docs/ruby-sdk-doc.md",sourceDirName:".",slug:"/ruby-sdk-doc",permalink:"/documentation/ruby-sdk-doc",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/ruby-sdk-doc.md",version:"current",frontMatter:{id:"ruby-sdk-doc",title:"Ruby SDK"},sidebar:"docs",previous:{title:"Node.js SDK",permalink:"/documentation/javascript-sdk-doc"},next:{title:"Go SDK",permalink:"/documentation/go-sdk-doc"}},c=[{value:"Getting Started",id:"getting-started",children:[]},{value:"Utilising the SDK in application code",id:"utilising-the-sdk-in-application-code",children:[]},{value:"Failed SSE Connections",id:"failed-sse-connections",children:[]},{value:"Usage",id:"usage",children:[{value:"Using without percentage rollout",id:"using-without-percentage-rollout",children:[]},{value:"<code>client.get_feature(key, default = nil) -&gt; boolean</code>",id:"clientget_featurekey-default--nil---boolean",children:[]},{value:"Using the percentage rollout strategy",id:"using-the-percentage-rollout-strategy",children:[]}]},{value:"Integrating with Google Analytics",id:"integrating-with-google-analytics",children:[]},{value:"Testing",id:"testing",children:[]}],d={toc:c};function p(e){var t=e.components,l=(0,a.Z)(e,r);return(0,o.kt)("wrapper",(0,i.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"ruby-sdk"},"Ruby SDK"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/pioneer-io/ruby-sdk/actions/workflows/verify.yml"},(0,o.kt)("img",{parentName:"a",src:"https://github.com/pioneer-io/ruby-sdk/actions/workflows/verify.yml/badge.svg",alt:"Test"}))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://rubygems.org/gems/pioneer_ruby_sdk"},(0,o.kt)("img",{alt:"npm Reference",src:n(1480).Z}))),(0,o.kt)("h2",{id:"getting-started"},"Getting Started"),(0,o.kt)("p",null,"The Pioneer Ruby SDK is available as a Ruby Gem: ",(0,o.kt)("a",{parentName:"p",href:"https://rubygems.org/gems/pioneer_ruby_sdk"},"https://rubygems.org/gems/pioneer_ruby_sdk")),(0,o.kt)("p",null,"First you need to install the Gem:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"gem install pioneer_ruby_sdk\n")),(0,o.kt)("h2",{id:"utilising-the-sdk-in-application-code"},"Utilising the SDK in application code"),(0,o.kt)("p",null,"Now, you will need to require the ",(0,o.kt)("inlineCode",{parentName:"p"},"pioneer_ruby_sdk")," gem in your application.\nTo create a new SDK client, the URI of the ",(0,o.kt)("inlineCode",{parentName:"p"},"scout")," daemon is required in addition to an SDK key, obtained from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Account")," tab of the Compass application's user interface. The default port for ",(0,o.kt)("inlineCode",{parentName:"p"},"scout")," is ",(0,o.kt)("inlineCode",{parentName:"p"},":3030")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"/features")," endpoint is the proper endpoint to receive flag updates."),(0,o.kt)("p",null,"The SDK client will receive ruleset updates in real-time via SSE any time a feature flag is created/updated/deleted via the Compass dashboard."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Ruby"},"require 'pioneer_ruby_sdk'\n\nsdk_client = PioneerRubySdk.new('/path/to/scout', 'sdk_key')\n\nsdk_connection = sdk_client.connect().with_wait_for_data()\n")),(0,o.kt)("h2",{id:"failed-sse-connections"},"Failed SSE Connections"),(0,o.kt)("p",null,"If the SDK fails to connect to the Scout daemon as an eventsource client, the connection attempt will be retried up to 10 times. "),(0,o.kt)("p",null,"If the connection fails 10 times, an error will be logged to the user (example below) and the SDK will stop trying to connect."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"Cannot connect to Scout, connection timed out\n")),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("h3",{id:"using-without-percentage-rollout"},"Using without percentage rollout"),(0,o.kt)("h3",{id:"clientget_featurekey-default--nil---boolean"},(0,o.kt)("inlineCode",{parentName:"h3"},"client.get_feature(key, default = nil) -> boolean")),(0,o.kt)("p",null,"This method will check the current ruleset for a flag by the name of ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," and return the boolean value associated with that flag. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Ruby"},"# assuming there is an existing flag titled 'test this flag' \n# whose active status is set to true\nputs sdk_connection.get_feature('test this flag') # -> true\n\n# a basic branch to use a microservice might look like this:\nputs 'What service is being called with `test this flag`?'\nif sdk_connection.get_feature('test this flag')\n    puts 'Calling some microservice...'\n    # call to new microservice goes here\nelse\n    puts 'Calling the monolith service...'\n    # monolith defined service call goes here\nend\n")),(0,o.kt)("p",null,"The default value is used to provide a redundant backup; if the SDK cannot find a flag for the given key and the default value was provided, it will use the default value and log warning notifying you that it had to fall back to the default value."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Ruby"},"sdk_connection.get_feature('whoops, no flag', true) \n# -> true\n# -> \"Warning: Could not get whoops, no flag from features, using provided default value!\"\n")),(0,o.kt)("h3",{id:"using-the-percentage-rollout-strategy"},"Using the percentage rollout strategy"),(0,o.kt)("p",null,"When a flag has a rollout percentage assigned to it, you can leverage the rollout strategy for that flag by giving the SDK instance a 'context'. This context is created using a unique identifier of your choosing, in string format.\nTo do so, use a unique identifier, and call the ",(0,o.kt)("inlineCode",{parentName:"p"},"with_context")," method on an existing SDK connection, passing in the identifier to create the context."),(0,o.kt)("p",null,"The SDK will determine whether the user's context falls within the rollout percentage. This is done by summing the values of the code points within the string argument, and modding by 100 (the maximum rollout percentage possible). If the resulting value is less than or equal to the flag's rollout percentage, ",(0,o.kt)("inlineCode",{parentName:"p"},"get_feature()")," will return ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),", and the user will funneled to the feature. If the user's context falls above the set rollout percentage, ",(0,o.kt)("inlineCode",{parentName:"p"},"get_feature()")," returns false."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Ruby"},"# creating the basic SSE connection\nsdk_connection = sdk_client.connect().with_wait_for_data()\n\n# pass in a string to identify an individual user e.g. cookie\nsdk_with_context = sdk_connection.with_context('2u43487328')\n\n# the context will generate a percent\n# if that percentage falls within that of the rollout\n# the feature will evaluate to true, otherwise false\nsdk_with_context.get_feature('test this flag')\n# -> true\n\n# with a different user identifier that creates a different percentage\nsdk_with_context = sdk_connection.with_context('448shIhn2i')\nsdk_with_context.get_feature('test this flag')\n# -> false\n")),(0,o.kt)("h2",{id:"integrating-with-google-analytics"},"Integrating with Google Analytics"),(0,o.kt)("p",null,"You can set up an integration with Google Analytics by providing an object with your GA tracking ID and a unique client id to ",(0,o.kt)("inlineCode",{parentName:"p"},"add_google_analytics_collector()"),". This tracking ID should begin with ",(0,o.kt)("inlineCode",{parentName:"p"},"UA-"),". The unique client id is used to distinguish the logs on the Analytics platform, so you can decide what identifier you would like to integrate based on your needs."),(0,o.kt)("p",null,"You can then log an analytics event any time you wish using ",(0,o.kt)("inlineCode",{parentName:"p"},"log_event()"),". This method takes one argument, an ",(0,o.kt)("inlineCode",{parentName:"p"},"event_object")," that must have the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"category"),(0,o.kt)("li",{parentName:"ul"},"action"),(0,o.kt)("li",{parentName:"ul"},"label"),(0,o.kt)("li",{parentName:"ul"},"value")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Ruby"},"config_object = {\n    tracking_id: 'UA-###',\n    client_id: 'unique id for test'\n}\n\nsdk_with_user.add_google_analytics_collector(config_object)\n\nevent_object = {\n    category: 'test',\n    action: 'some action',\n    label: 'new label',\n    value: '1234'\n}\nsdk_with_user.log_event(event_object)\n")),(0,o.kt)("h2",{id:"testing"},"Testing"),(0,o.kt)("p",null,"To run a basic suite of unit tests, just ",(0,o.kt)("inlineCode",{parentName:"p"},"rake")," from the main directory."))}p.isMDXComponent=!0},1480:function(e,t,n){t.Z=n.p+"assets/images/ruby_badge-4449bb0bb963784c4fbd964318c3645d.svg"}}]);